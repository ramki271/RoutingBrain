department: rd
version: "2.0"
description: "R&D department routing policy — coding, review, testing, architecture, documentation"

budget_controls:
  daily_limit_usd_per_user: 10.00
  daily_limit_usd_per_tenant: 100.00
  downgrade_at_percent: 80.0
  force_cheap_at_percent: 100.0

rules:
  # ── Code Generation ──────────────────────────────────────────────────────────
  - name: code_gen_simple
    task_type: code_generation
    complexity: simple
    primary_model: rb://fast_cheap_code
    fallback_models: [rb://fast_cheap_review, rb://local_code]
    model_tier: fast_cheap
    rationale: "Fast, cheap, strong on boilerplate"

  - name: code_gen_medium
    task_type: code_generation
    complexity: medium
    primary_model: rb://balanced_code
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Best code quality/cost balance"

  - name: code_gen_complex
    task_type: code_generation
    complexity: complex
    primary_model: rb://powerful_code
    fallback_models: [rb://balanced_code, rb://balanced_general]
    model_tier: powerful
    rationale: "Novel algorithms need max capability"

  # ── Code Review ───────────────────────────────────────────────────────────────
  - name: code_review_simple
    task_type: code_review
    complexity: simple
    primary_model: rb://fast_cheap_review
    fallback_models: [rb://fast_cheap_code]
    model_tier: fast_cheap
    rationale: "Pattern matching, fast"

  - name: code_review_medium
    task_type: code_review
    complexity: medium
    primary_model: rb://balanced_reasoning
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Nuanced structural reasoning"

  - name: code_review_complex
    task_type: code_review
    complexity: complex
    primary_model: rb://powerful_reasoning
    fallback_models: [rb://balanced_reasoning]
    model_tier: powerful
    rationale: "Deep security and architecture review"

  # ── Test Generation ───────────────────────────────────────────────────────────
  - name: test_gen_simple
    task_type: test_generation
    complexity: simple
    primary_model: rb://fast_cheap_code
    fallback_models: [rb://fast_cheap_review, rb://local_code]
    model_tier: fast_cheap
    rationale: "Boilerplate test scaffolding"

  - name: test_gen_medium
    task_type: test_generation
    complexity: medium
    primary_model: rb://balanced_code
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Understands code structure for meaningful tests"

  - name: test_gen_complex
    task_type: test_generation
    complexity: complex
    primary_model: rb://powerful_code
    fallback_models: [rb://balanced_code]
    model_tier: powerful
    rationale: "Complex integration test suites and edge case coverage"

  # ── Debugging ─────────────────────────────────────────────────────────────────
  - name: debugging_simple
    task_type: debugging
    complexity: simple
    primary_model: rb://fast_cheap_code
    fallback_models: [rb://fast_cheap_review]
    model_tier: fast_cheap
    rationale: "Common errors, quick fix"

  - name: debugging_medium
    task_type: debugging
    complexity: medium
    primary_model: rb://balanced_reasoning
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Multi-file debugging needs reasoning"

  - name: debugging_complex
    task_type: debugging
    complexity: complex
    primary_model: rb://powerful_debug
    fallback_models: [rb://powerful_reasoning, rb://balanced_reasoning]
    model_tier: powerful
    rationale: "Extended thinking for hard bugs"

  # ── Architecture Design ───────────────────────────────────────────────────────
  - name: architecture_simple
    task_type: architecture_design
    complexity: simple
    primary_model: rb://balanced_reasoning
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Simple design decisions"

  - name: architecture_complex
    task_type: architecture_design
    complexity: complex
    primary_model: rb://powerful_reasoning
    fallback_models: [rb://balanced_general]
    model_tier: powerful
    rationale: "Best for trade-off analysis"

  # ── Documentation ─────────────────────────────────────────────────────────────
  - name: docs_simple
    task_type: documentation
    complexity: simple
    primary_model: rb://fast_cheap_docs
    fallback_models: [rb://fast_cheap_review, rb://local_general]
    model_tier: fast_cheap
    rationale: "Simple docstrings and comments"

  - name: docs_medium
    task_type: documentation
    complexity: medium
    primary_model: rb://balanced_reasoning
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Clear technical prose"

  # ── Requirement Analysis ──────────────────────────────────────────────────────
  - name: requirement_analysis_medium
    task_type: requirement_analysis
    complexity: medium
    primary_model: rb://balanced_reasoning
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Evaluates completeness and ambiguity"

  - name: requirement_analysis_complex
    task_type: requirement_analysis
    complexity: complex
    primary_model: rb://powerful_reasoning
    fallback_models: [rb://balanced_reasoning]
    model_tier: powerful
    rationale: "Deep feasibility and conflict analysis"

  # ── Data Analysis ─────────────────────────────────────────────────────────────
  - name: data_analysis_simple
    task_type: data_analysis
    complexity: simple
    primary_model: rb://fast_cheap_qa
    fallback_models: [rb://fast_cheap_review]
    model_tier: fast_cheap
    rationale: "Large context, low cost"

  - name: data_analysis_complex
    task_type: data_analysis
    complexity: complex
    primary_model: rb://balanced_data
    fallback_models: [rb://powerful_reasoning]
    model_tier: balanced
    rationale: "2M context for large codebases and logs"

  # ── Math / Algorithm Reasoning ────────────────────────────────────────────────
  - name: math_reasoning_complex
    task_type: math_reasoning
    complexity: complex
    primary_model: rb://powerful_math
    fallback_models: [rb://powerful_reasoning]
    model_tier: powerful
    rationale: "Built specifically for extended mathematical reasoning"

  # ── Q&A ──────────────────────────────────────────────────────────────────────
  - name: qa_simple
    task_type: question_answer
    complexity: simple
    primary_model: rb://fast_cheap_qa
    fallback_models: [rb://fast_cheap_code, rb://fast_cheap_review]
    model_tier: fast_cheap
    rationale: "Lowest latency and cheapest"

  - name: qa_medium
    task_type: question_answer
    complexity: medium
    primary_model: rb://balanced_reasoning
    fallback_models: [rb://balanced_general]
    model_tier: balanced
    rationale: "Detailed technical answers"

default_rule:
  name: rd_default
  primary_model: rb://balanced_code
  fallback_models: [rb://balanced_general]
  model_tier: balanced
  rationale: "Safe default for R&D tasks"
